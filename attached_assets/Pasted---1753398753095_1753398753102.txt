مفهوم "عقار مكرر": هو عقار يتم تصنيفه على أنه مكرر إذا تم العثور على تشابه (مطابقة) بينه وبين عقارات أخرى بناءً على الشروط التالية التي يجب أن تتحقق جميعها:
•	رقم المالك: يجب أن يتطابق رقم المالك.
•	المنطقة: يجب أن تتطابق المنطقة.
•	نوع العقار: يجب أن يتطابق نوع العقار.
•	حالة العقار: يجب أن تتطابق حالة العقار.
•	المساحة: يجب أن تتطابق المساحة.
•	الدور: يجب أن يتطابق الدور.
ملاحظات حول التصنيف:
•	هذا التصنيف ليس عيباً في العقار بحد ذاته.
•	تُعالج حالة التكرار بإحدى طريقتين يدويتين من قبل المستخدم:
o	إما حذف العقار إذا كان التكرار خطأ.
o	أو إلغاء خاصية التكرار إذا كان المالك يمتلك بالفعل عقارين بنفس المواصفات.
كيفية تعامل النظام بعد اكتشاف "عقار مكرر": بعد تسجيل ومعالجة العقار بنجاح، يتم إرسال إشعار إلى بوت التليجرام يوضح أن هذا العقار هو "عقار مكرر"، مع تضمين:
•	رابط الصفحة الشخصية للعقار المُعالج.
•	رابط الصفحة الخاصة بالعقار المتشابه معه.

-------------------------------------------
مفهوم "عقار متعدد": هو عقار تمت مقارنته مع عقارات أخرى، ووُجد أنه يتشابه معها فقط في "رقم المالك". هذا يعني أن المالك نفسه يمتلك أكثر من عقار.
كيفية تعامل النظام مع "عقار متعدد": عندما يتم معالجة هذا العقار بنجاح:
1.	يتم إنشاء صفحة عقار جديدة.
2.	يتم ربط صفحة العقار الجديدة هذه بالمالك الموجود مسبقاً (الذي يمتلك نفس رقم المالك).
3.	يتم إنشاء العلاقة الثنائية بين صفحة العقار الجديدة وصفحة المالك.
4.	النتيجة: يصبح المالك الواحد لديه أكثر من صفحة عقار مرتبطة به

هذه العمليات على نوشن باستخدام الفانكشن أو أي وظيفة أخرى

================================================
. استلمنا البيان من تيليجرام
2. حللنا البيان إلى JSON
3. نفذنا بحثًا في Notion:
    - هل يوجد عقار مطابق تمامًا؟ → "عقار مكرر"
    - هل يوجد مالك بنفس الرقم؟ → "عقار متعدد"
    - لا يوجد شيء؟ → "عقار جديد"

4. خزّنا البيان مع التصنيف في Notion علي مرحلتين كل البيان ماعدا حقلين الي صفحه عقاروحقل اسم المالك ورقم المالك الي صفحه مالك العقار
وكذالك ارسال البيان بالكامل الئ زوهو سي ار ام
5. أرسلنا إشعارًا بالنتيجة عبر بوت التيليجرام

اسماء الحقول اي بي اي في زوهو سي ار ام
ZOHO_FIELD_MAP = {
    "البيان": "Name",
    "اتاحة العقار": "field12",
    "اسم الموظف": "field13",
    "نوع الوحدة": "field14",
    "حالة الصور": "field11",
    "الدور": "field10",
    "المساحة": "field9",
    "حالة الوحدة": "field8",
    "المنطقة": "field7",
    "كود الوحدة": "field6",
    "اسم المالك": "field5",
    "رقم المالك": "field4",
    "العنوان": "field3",
    "المميزات": "field2",
    "تفاصيل كاملة": "field1",
    "السعر": "field"
=============================
ZOHO_FIELD_MAP = {
    "البيان": "Name",
    "اتاحة العقار": "field12",
    "اسم الموظف": "field13",
    "نوع الوحدة": "field14",
    "حالة الصور": "field11",
    "الدور": "field10",
    "المساحة": "field9",
    "حالة الوحدة": "field8",
    "المنطقة": "field7",
    "كود الوحدة": "field6",
    "اسم المالك": "field5",
    "رقم المالك": "field4",
    "العنوان": "field3",
    "المميزات": "field2",
    "تفاصيل كاملة": "field1",
    "السعر": "field"
============================
 

    مثال للإخراج المتوقع (JSON فقط):
    
json
    {{
      "المنطقة": جاردينيا هايتس",
      "كود الوحدة": "000-1-5-220725-123",
      "نوع الوحدة": "شقة",
      "حالة الوحدة": "مفروش",
      "المساحة": "150",
      "الدور": "دور تالت",
      "السعر": "20000",
      "المميزات": "مكيفه, فيو مفتوح, اسانسير, انترنت",
      "العنوان": "شارع التسعين الشمالي، التجمع الخامس",
      "اسم الموظف": "يوسف عماد",
      "اسم المالك": "هدي المفتي",
      "رقم المالك": "01000011109",
      "اتاحة العقار": "متاح",
      "حالة الصور": "بصور",
      "تفاصيل كاملة": "شقة مفروشة بالكامل في التجمع الخامس، 150 متر، دور ثالث، مكيفة، فيو مفتوح، اسانسير، انترنت، إيجار شهري 20000 جنيه."
    }}
========================
مفهوم "عقار فاشل": هو أي عقار بدأت عملية معالجته (بعد استلام الرسالة الأصلية) وتوقفت في أي مرحلة قبل اكتمالها، أو فشلت العملية حتى قبل أن تبدأ المعالجة الأولية.
كيفية تعامل النظام مع "العقار الفاشل":
1.	مسح الرسالة الأصلية: يتم حذف الرسالة التي تحتوي على بيانات العقار الأصلي.
2.	إنشاء رسالة جديدة: يتم إنشاء رسالة جديدة تحتوي على "حقل البيان" الذي هو حقل مستقل بذاته ويتكون من المحتوى المُصاغ من الحقول التالية فقط:
o	نوع العقار
o	حالة العقار
o	المنطقة
o	المساحة
o	الدور
o	السعر
o	كود الشقة
o	اسم الموظف
o	حالة الصور بالإضافة إلى الحقول الأخرى خارج البيان في الرسالة الجديدة وهي:
o	اسم المالك
o	رقم المالك
o	اتاحة العقار
o	تفاصيل كاملة
3.	وسم الرسالة الجديدة: يتم وسم هذه الرسالة الجديدة التي تم إنشاؤها بـ "عقار فاشل".
4.	قابلية المعالجة المتكررة: تظل هذه الرسالة الجديدة (الموسومة بـ "عقار فاشل") قابلة للمعالجة بشكل متكرر حتى تتم معالجتها بنجاح.
------------------------------------------------
مفهوم "عقار مكرر": هو عقار يتم تصنيفه على أنه مكرر إذا تم العثور على تشابه (مطابقة) بينه وبين عقارات أخرى بناءً على الشروط التالية التي يجب أن تتحقق جميعها:
•	رقم المالك: يجب أن يتطابق رقم المالك.
•	المنطقة: يجب أن تتطابق المنطقة.
•	نوع العقار: يجب أن يتطابق نوع العقار.
•	حالة العقار: يجب أن تتطابق حالة العقار.
•	المساحة: يجب أن تتطابق المساحة.
•	الدور: يجب أن يتطابق الدور.
ملاحظات حول التصنيف:
•	هذا التصنيف ليس عيباً في العقار بحد ذاته.
•	تُعالج حالة التكرار بإحدى طريقتين يدويتين من قبل المستخدم:
o	إما حذف العقار إذا كان التكرار خطأ.
o	أو إلغاء خاصية التكرار إذا كان المالك يمتلك بالفعل عقارين بنفس المواصفات.
كيفية تعامل النظام بعد اكتشاف "عقار مكرر": بعد تسجيل ومعالجة العقار بنجاح، يتم إرسال إشعار إلى بوت التليجرام يوضح أن هذا العقار هو "عقار مكرر"، مع تضمين:
•	رابط الصفحة الشخصية للعقار المُعالج.
•	رابط الصفحة الخاصة بالعقار المتشابه معه.

-------------------------------------------
مفهوم "عقار متعدد": هو عقار تمت مقارنته مع عقارات أخرى، ووُجد أنه يتشابه معها فقط في "رقم المالك". هذا يعني أن المالك نفسه يمتلك أكثر من عقار.
كيفية تعامل النظام مع "عقار متعدد": عندما يتم معالجة هذا العقار بنجاح:
1.	يتم إنشاء صفحة عقار جديدة.
2.	يتم ربط صفحة العقار الجديدة هذه بالمالك الموجود مسبقاً (الذي يمتلك نفس رقم المالك).
3.	يتم إنشاء العلاقة الثنائية بين صفحة العقار الجديدة وصفحة المالك.
4.	النتيجة: يصبح المالك الواحد لديه أكثر من صفحة عقار مرتبطة به.

-------------------------------------------------
كيفية معالجة العقارات في القناة:
•	الشرط الأساسي للمعالجة: في كل مرة تبدأ فيها جلسة جديدة، أو طالما كانت الجلسة مستمرة، يتم معالجة جميع العقارات الموجودة في القناة.
•	استثناء من المعالجة: العقارات التي تحمل وسم "عقار ناجح" يتم استثناؤها من هذه المعالجة المتكررة.
•	فلتر "تاريخ آخر تحديث ناجح" (لتخفيف الضغط):
o	يتم تفعيل هذا الفلتر (أو أخذه في الاعتبار) فقط في حالة واحدة: عندما تكون جميع العقارات الموجودة في القناة، بلا استثناء، قد تمت معالجتها بنجاح وتحمل وسم "عقار ناجح".
o	(فهمي هنا أن هذا الفلتر سيسمح بتحديد نقطة زمنية معينة للبدء منها في المعالجة، بدلاً من البدء من البداية في كل مرة، ولكن فقط عندما تكون القناة "نظيفة" من العقارات غير المعالجة بنجاح.)

-----------------------------------------------------------
مفهوم "عقار ناجح": هو العقار الذي تتم معالجته بنجاح كامل، أي تتوافر وتكون صحيحة جميع الأجزاء/الحقول الخاصة به.
كيفية تعامل النظام مع "العقار الناجح": عندما يصبح العقار ناجحاً:
1.	يتم تصديره إلى Zoho.
2.	يتم تصديره إلى Notion، حيث يتم إنشاء صفحة خاصة به كعقار، وصفحة خاصة بالمالك (أو تحديث الموجودة)، ويتم ربطهما ببعض.
3.	يتم حذف الرسالة الأصلية التي وردت في القناة.
4.	يتم استبدال الرسالة الأصلية برسالة جديدة، بنفس التنسيق الذي تم الاتفاق عليه سابقاً لـ"عقار فاشل" (أي تتكون من حقل البيان الذي يضم: نوع العقار، حالة العقار، المنطقة، المساحة، الدور، السعر، كود الشقة، اسم الموظف، حالة الصور؛ بالإضافة إلى حقول اسم المالك، رقم المالك، اتاحة العقار، وتفاصيل كاملة).
5.	توسم هذه الرسالة الجديدة بـ"عقار ناجح".
---------------------------------------------
القاعدة: سلسلة معالجة الرسائل الخام بواسطة الذكاء الاصطناعي
بعد أن تصل الرسالة الخام إلى البوت، سيتم توجيهها إلى سلسلة من منصات الذكاء الاصطناعي لمعالجتها.
آلية التوجيه والمعالجة:
•	يتم توجيه الرسالة إلى هذه المنصات على التوالي (بالتسلسل).
•	يتوقف النظام عن الإرسال إلى المنصات التالية بمجرد نجاح إحداها في المعالجة. أي، إذا نجحت المنصة الأولى في السلسلة، فلن يتم إرسال الرسالة إلى المنصات المتبقية.
محاولات الإرسال لكل منصة:
•	يحاول النظام إرسال الطلب إلى كل منصة ذكاء اصطناعي حتى 3 مرات.
•	يتم الفصل بين كل محاولة والأخرى بفاصل زمني (مثلاً ثانية واحدة).
•	إذا تم الحصول على نتيجة ناجحة من أي من هذه المحاولات، يتوقف النظام فوراً ويستخدم هذه النتيجة.
في حالة فشل جميع المحاولات (لكل المنصات في السلسلة):
1.	يتم إرسال إشعار فوري إليك (المستخدم).
2.	يطلب منك الإشعار: "هل نكمل التحليل المنطقي؟"
3.	إذا كانت الإجابة "نعم": يتم تمرير "البيان" (المستخرج حتى تلك النقطة) إلى محلل بايثون الداخلي.
4.	إذا كانت الإجابة "لا": تتوقف العملية، وتكون مسؤوليتك (المستخدم) هي تحليل البيان يدوياً وإعادة إرساله.
المنصات التي سيتم محاولة استخدامها في السلسلة (إن أمكن):
•	Google Gemini
•	OpenAI
•	Microsoft Copilot
•	Mistral
•	Hugging Face
•	Cohere
•	Groq
------------------------------------------------------
لقاعدة 8: دليل تحليل بيانات العقارات وتنسيق البيان الكامل
•	الهدف: تحليل البيانات الخام وتنسيقها إلى "البيان العقاري الكامل".
•	تنسيق الناتج: حقل نصي واحد مع كل حقل وقيمته داخل [] وفي سطر جديد. ترتيب إلزامي للحقول.
•	قواعد تحليل الحقول وقيمها الافتراضية: (كما تم تفصيلها سابقاً، مع التحديثات التالية):
o	المناطق: z5 تشمل "حي اندلس" وz3 تشمل "اسكان شباب".
o	كود الوحدة: إذا تعذر استخراج مكونات الكود، يُعوض بـ"غير محدد" في الحقل و0 في الكود نفسه.
o	اسم المالك: القيمة الافتراضية "غير معروف".
o	عام: يجب ألا يحتوي الناتج الكامل على "ال" التعريف.
•	تصنيف "عقار تالف":
o	يُعتبر العقار تالفاً إذا لم تتوافر قيمة لأي من الحقول التالية: المنطقة، نوع الوحدة، حالة الوحدة، كود الوحدة، اسم المالك، رقم المالك.
o	عند معالجته بنجاح، يُرسل إشعار النجاح بأنه "عقار تالف" مع رابط لإصلاحه يدوياً.
•	التعويضات الافتراضية العامة: حقول نصية "غير محدد"، رقمية 00، رقم المالك 01000000000.
•	معالجة الإدخالات المتعددة: كل بيان يُعالج بشكل مستقل. الرقم التسلسلي لكود الوحدة يبدأ من 1 لكل مجموعة بيانات تحليل، ويتصاعد بمقدار 1 لكل بيان على حدة في نفس الطلب، وينتهي العد في اليوم ويبدأ من جديد كل يوم.
•	تنسيق الناتج الداخلي JSON.
________________________________________
القاعدة 9: آلية معالجة البيانات المتعددة (الدفعات)
•	تستمر معالجة البيانات المتعددة بالتوالي لتسهيل متابعة الإشعارات.
•	في حال فشل معالجة عقار واحد، تستكمل معالجة باقي العقارات في الدفعة.
•	بعد انتهاء جميع العقارات في الدفعة، يعود النظام لمعالجة العقارات التي فشلت مرة أخرى.
1. تحديثات على تعريفات المناطق (Zones):
•	z5: أصبحت تشمل: كمباوندات، احياء تجمع، بيت وطن، نرجس، لوتس، شويفات، زيزينيا، حي اندلس. (تم تحديد "حي اندلس" بشكل أكثر وضوح).
•	z3: أصبحت تشمل: اسكان شباب، سكن شباب، مستقبل، هناجر، نزهه ثالث. (تم إضافة "اسكان شباب" كقيمة مباشرة).
2. ملاحظة هامة حول حقل كود الوحدة [كود الوحدة: ...] وتصنيف "عقار تالف":
•	إذا تعذّر استخراج قيمة لأي من العناصر الإلزامية الثلاثة لكود الوحدة (نوع الحالة، رقم المنطقة، التاريخ):
o	داخل الحقل نفسه في البيان الناتج (مثل [كود الوحدة: غير محدد])، تُعوض القيمة بـ "غير محدد".
o	أما داخل سلسلة الكود الفعلية (c000-X-zY-DDMMYY-وحدة-رقم-تسلسلي)، تُعوض القيمة المفقودة بـ 0.
•	في هذه الحالة، يُعتبر العقار "عقار تالف". هذا التصنيف لا يعيق تحليله، وسيتم إرسال إشعار في نهاية العملية مع رابط العقارلإصلاحه.
3. قاعدة عامة لتنسيق الناتج ("ال" التعريف):
•	يجب ألا يحتوي الناتج الكامل (أي قيم الحقول في البيان النهائي) على "ال" التعريف. (هذا يطبق على جميع الحقول التي يمكن أن تحتويها، مثل "المميزات" و"الدور" وغيرها).
4. تحديث القيمة الافتراضية لحقل اسم المالك:
•	القيمة الافتراضية لحقل [اسم المالك: ...] إذا لم تُذكر هي الآن: "غير معروف" (بدلاً من "غير محدد").
5. تعريف وتصنيف "عقار تالف" الجديد:
•	يُعتبر العقار تالفاً إذا لم تتوافر قيمة لأي من الحقول التالية:
o	المنطقة
o	نوع الوحدة
o	حالة الوحدة
o	كود الوحدة
o	اسم المالك
o	رقم المالك
•	عندما يُعالج العقار بنجاح (رغم اعتباره تالفاً)، يتم إرسال إشعار بنجاح المعالجة، ويُضاف إليه أنه "عقار تالف" مع رابط للصفحة الخاصة به لتتمكن من إصلاحه يدوياً.
6. حذف قواعد سابقة:
•	تم حذف القاعدة التي تنص على "يجب أن تتوقف عملية التحليل ويُطلب إدخال يدوي" إذا غابت حقول المنطقة، نوع الوحدة، حالة الوحدة، أو كود الوحدة. (فهمي هو أن هذه الحالات ستُعامل الآن ضمن تصنيف "عقار تالف" بدلاً من إيقاف المعالجة).
•	القاعدة المتعلقة بالترقيم التلقائي للرقم التسلسلي في كود الوحدة الذي يبدأ من 1 لكل بيان فردي. (هذا يعني أن الجزء الذي ينص على "إذا تم تحليل عدة بيانات في نفس الطلب، يتصاعد هذا الرقم بمقدار 1 لكل بيان على حدة" قد تم إلغاؤه. ولكن فهمي أن "الرقم التسلسلي للوحدة يبدأ من 1 لكل مجموعة بيانات تحليل. وينتهي العد في يوم وييدا العد من جديد كل يوم
o	أرجو توضيح هذه النقطة: هل مازال يتم حذف الرسالة الأصلية واستبدالها بالبيان المنسق (كما اتفقنا للعقار الفاشل والناجح)، أم أن ما يُرسل للقناة هو دائماً النص الأصلي بغض النظر عن حالة المعالجة؟
8. آلية معالجة البيانات المتعددة:
•	تستمر عملية المعالجة على البيانات المتعددة بالتوالي لكي يسهل متابعة الإشعارات.
•	في حالة فشل أحدها (أحد العقارات في دفعة المعالجة): تستكمل عملية المعالجة حتى تنتهي جميع العقارات في الدفعة.
•	ثم يعود النظام إلى العمليات الفاشلة ليعيد معالجتها.
________________________________________
•	1. ما يُرسل إلى القناة (النص الأصلي مقابل البيان المنسق):
•	الفهم الجديد: "ولكن الذي يرسل إلى القناة النص الأصلي" يشير إلى عملية تحدث قبل المعالجة الأساسية التي تؤدي إلى تصنيف "عقار فاشل" أو "عقار ناجح".
•	هذا يعني أن:
•	في مرحلة ما قبل المعالجة، قد يتم إرسال النص الأصلي للرسالة إلى القناة.
•	ثم، بعد اكتمال المعالجة ووصول العقار لحالة "ناجح" أو "فاشل": يتم حذف الرسالة الأصلية ويُستبدل بها الرسالة الجديدة المنسقة (البيان) الموسومة بالحالة المناسبة (كما اتفقنا سابقاً).
•	بهذا، لا يوجد تعارض بين القاعدتين.
•	-------------------------------------------------------•  يتم تخزين البرومبت (الدليل) الذي يُرسل إلى منصات الذكاء الاصطناعي لتحليل البيان العقاري بناءً عليه، في ملف منفصل.
•	•  الهدف من هذا الملف المنفصل هو تسهيل تعديله وتطويره مستقبلاً.
•	---------------------------------
نعم، أتفهم تماماً التعديل والإضافة الهامة بخصوص التقارير اليومية.
•	________________________________________
•	القاعدة: ملف التقارير اليومية (محدثة)
•	يتم إنشاء ملف مخصص للتقارير.
•	يتم إرسال تقارير يومية توضح الإحصائيات التالية:
•	إجمالي عدد العقارات في القناة.
•	عدد العقارات الناجحة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات الفاشلة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات التالفة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات المكررة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات المتعددة، مع الروابط الخاصة بهذه الصفحات.
•	آخر تاريخ تحديث.
•	عدد العقارات التي تخص كل موظف (موزعة حسب اسم الموظف).
•	يتم تقديم هذه التقارير بشكل يومي.
•	
----------------------------------------------
لقاعدة: محتوى الإشعارات
•	كل إشعار يتم إرساله بخصوص عقار، يجب أن يوافقه (يتضمن):
•	كود العقار.
•	رابط الصفحة الخاصة به، وذلك إذا كان العقار يندرج تحت أحد التصنيفات التالية:
•	الفاشلة (عقار فاشل)
•	التالفة (عقار تالف)
•	المكررة (عقار مكرر)
•	المتعددة (عقار متعدد)
•	
-----------------------------
القاعدة: حقل "ستاتيوس" في Notion (محدثة)
•	يوجد حقل في Notion يُسمى "ستاتيوس" (Status).
•	نوع هذا الحقل هو "Multi-select" (اختيار متعدد).
•	يحتوي هذا الحقل على التصنيفات التالية:
•	عقار تالف
•	عقار فاشل
•	عقار متعدد
•	عقار مكرر
•	يتم تخصيص السمة (التصنيف) المقابلة لكل عقار في Notion بما يتناسب مع تفاصيله.
•	إضافة خاصة بتصنيف "عقار فاشل":
•	عندما يكون العقار "فاشلاً"، تُضاف إليه هذه السمة في حقل "ستاتيوس" في Notion.
•	وعندما تكتمل معالجة هذا العقار بنجاح مرة أخرى، تُحذف قيمة "عقار فاشل" من حقل "ستاتيوس" الخاص به.
•	
-----------------------------------
يتم إضافة أيقونة "صح" (✅) لكل عقار ناجح في صفحة العقار الخاصة به في Notion.
•	هذه الأيقونة تعمل كدليل بصري على أن العقار قد تمت معالجته بنجاح.
•	
--------------------------------
 إعادة تنظيم المشروع بشكل معياري (Modular) لتقسيم المعالجة، الإشعارات، الإدخال/الإخراج، والتكاملات (Notion/Zoho).

 فصل المعالجة على مراحل واضحة: (تحليل AI > تصنيف العقار > إدخال بيانات > تحديث القناة).

🤖 سلاسل المعالجة بالذكاء الاصطناعي
 إعداد سلسلة من مزودي الذكاء الاصطناعي (Gemini, OpenAI, Copilot, إلخ) مع ثلاث محاولات لكل مزود، والتوقف عند أول نجاح.

 دعم fallback إلى المعالج المحلي في بايثون إذا فشل الجميع، مع خيار "هل نكمل التحليل؟" للمستخدم.

 استخراج البيان بصيغة JSON بتنسيق موحد: كل حقل على سطر [اسم الحقل: القيمة] بدون "ال".

📋 تصنيف العقار بعد المعالجة
 تحديد نوع العقار (ناجح، فاشل، تالف، مكرر، متعدد) بناءً على المعايير السابقة.

 تحديث حالة العقار في Notion → حقل "Status" (Multi-select) بإضافة الحالة المناسبة.

 إضافة رمز ✅ في الصفحة إذا كان العقار ناجحًا.

🔁 معالجة الرسائل
 استبدال الرسائل الأصلية في القناة برسائل منسقة جديدة تحمل وسم (عقار ناجح/فاشل).

 يجب أن تحتوي الرسالة المنسقة الجديدة على:

البيان المنسق

حقول خارج البيان: اسم المالك، رقم المالك، الإتاحة، تفاصيل إضافية.

🔁 إدارة التكرار والتعدد
 بعد الإدخال، يتم التحقق من Zoho/Notion:

 إذا كانت القيم متطابقة → عقار مكرر → إشعار مع رابط العقارين.

 إذا تطابق رقم المالك فقط → عقار متعدد → ربطه بصفحة المالك الموجودة.

📈 تقارير يومية
 يتم إنشاء ملف تقارير يومي يحتوي على:

إجمالي العقارات.

عدد وتصنيف كل حالة (ناجح، فاشل، تالف، مكرر، متعدد).

روابط الصفحات الخاصة بكل حالة.

توزيع العقارات حسب اسم الموظف.

آخر تاريخ تحديث.

🔔 إشعارات تيليجرام
 كل إشعار يجب أن يتضمن كود العقار + رابط الصفحة إذا كان فاشل/تالف/مكرر/متعدد.

 إشعار خاص إذا فشل تحليل AI بالكامل.


====================================
====================================

المشروع عبارة عن ملف بايثون أريد أن بوت تيليجرام سيستلم رسائل بها بيانات عقارات يقوم بتوجيهها إلى عدة منصات ذكاء إصطناعي بالترتيب إذا تجاوبت أول منصة يقوم بتفكيكها وتوجيهها إلى قناة خاصة في تليجرام وإذا لم يقوم أول منصة بتفكيكها يبدأ في إرسالها لآخر حتى يستجيب واحد فيهم وعندما يتم تفكيك الرسالة بصيغة جيسون يتم توجيهها إلى قناة خاصة للتليجرام وهناك يتم التعامل معها حيث يتم توجيهها إلى نوشن وزهو لتخزينها هناك ثم استقبال إشعار بتأكيد العملية أو فشلها ثم تنسيق البيان الذي وصل إلى القناة
📌 اسم المشروع (اقتراح):
"Aqar AI Dispatcher"

📦 نوع المشروع:
سكربت Python دائم التشغيل.

يستخدم بوت تيليجرام كواجهة إدخال وإخراج.

متكامل مع منصات ذكاء اصطناعي وNotion + Zoho.

🎯 الهدف:
استقبال رسائل عقارية من تيليجرام.

تحليلها باستخدام أكثر من منصة ذكاء صناعي واحدة تلو الأخرى.

بمجرد الحصول على نتيجة JSON، إرسالها إلى:

قناة تيليجرام أرشيفية.

Notion وZoho لتخزينها رسميًا.

إرسال إشعار نجاح أو فشل عبر تليجرام.

تنسيق البيان النهائي لتوثيقه بصيغة مرئية جميلة في القناة.

تشغيل المشروع على سيرفر مجاني مثل Railway
سيتم استخدام قناتين تليجرام: واحدة للأرشيف (منسق)، وأخرى للتنبيهات (نجاح/
مكن عمل واجهة لاحقًا (Dashboard) لتعديل البيانات يدويًا أو مراجعتها.
🧾 1. البيان العقاري (العنصر الأساسي)
عبارة عن رسالة نصية مثل:

"شقة مفروشة 120 متر في التجمع، الدور الثالث، 3 غرف، مطلوب 20 ألف، رقم المالك: 010123..."

🔎 التحليل ينتج كائن JSON:
json
نسخ الكود
{
  "كود الوحدة": "AQR-0001",
  "المنطقة": "التجمع الثالث",
  "نوع الوحدة": "شقة",
  "حالة الوحدة": "مفروش",
  "المساحة": "120",
  "الدور": "الثالث",
  "عدد الغرف": "3",
  "عدد الحمامات": "2",
  "السعر": "20000",
  "اسم المالك": "أ. خالد",
  "رقم المالك": "01012345678",
  "ملاحظات": "الشقة مكيفة بالكامل"
}

📦 3. نظام التخزين النهائي
📄 Notion:
صفحة مخصصة بعنوان "عقار"

كل صف يمثل وحدة (عقار)، يحتوي على كل الحقول أعلاه.

صفحة أخرى تدعي "مالك عقار" وتحتوي علي حقل اسم المالك وحقل رقم المالك.

📄 Zoho CRM:
اسم الموديول"Aqar"
استقبال الرسالة من تليجرام.

تجربة كل AI واحدة تلو الأخرى.

عند نجاح التحليل:

استخراج JSON.

إرساله إلى قناة تليجرام بتنسيق بصري.

إرسال البيانات إلى Notion.

إرسالها إلى Zoho.

إشعار بالنجاح.

عند الفشل:

إشعار بفشل التحليل.

(اختياري) إرسال الرسالة إلى مسؤول بشري لمراجعتها.
🟩 المرحلة 6: التحديات المحتملة
التحدي	الحل
بعض الرسائل غير مفهومة	محلل داخلي ذكي يعتمد على regex
سرعة الاستجابة	الاعتماد على أول AI يرد
حماية البوت من السبام	فلترة الرسائل بناءً على المستخدم أو القناة
كثرة الأخطاء في الكتابة	تحسين regex ودعم الكلمات العامية
=========================================

مفهوم "عقار فاشل": هو أي عقار بدأت عملية معالجته (بعد استلام الرسالة الأصلية) وتوقفت في أي مرحلة قبل اكتمالها، أو فشلت العملية حتى قبل أن تبدأ المعالجة الأولية.
كيفية تعامل النظام مع "العقار الفاشل":
1.	مسح الرسالة الأصلية: يتم حذف الرسالة التي تحتوي على بيانات العقار الأصلي.
2.	إنشاء رسالة جديدة: يتم إنشاء رسالة جديدة تحتوي على "حقل البيان" الذي هو حقل مستقل بذاته ويتكون من المحتوى المُصاغ من الحقول التالية فقط:
o	نوع العقار
o	حالة العقار
o	المنطقة
o	المساحة
o	الدور
o	السعر
o	كود الشقة
o	اسم الموظف
o	حالة الصور بالإضافة إلى الحقول الأخرى خارج البيان في الرسالة الجديدة وهي:
o	اسم المالك
o	رقم المالك
o	اتاحة العقار
o	تفاصيل كاملة
3.	وسم الرسالة الجديدة: يتم وسم هذه الرسالة الجديدة التي تم إنشاؤها بـ "عقار فاشل".
4.	قابلية المعالجة المتكررة: تظل هذه الرسالة الجديدة (الموسومة بـ "عقار فاشل") قابلة للمعالجة بشكل متكرر حتى تتم معالجتها بنجاح.
------------------------------------------------
مفهوم "عقار مكرر": هو عقار يتم تصنيفه على أنه مكرر إذا تم العثور على تشابه (مطابقة) بينه وبين عقارات أخرى بناءً على الشروط التالية التي يجب أن تتحقق جميعها:
•	رقم المالك: يجب أن يتطابق رقم المالك.
•	المنطقة: يجب أن تتطابق المنطقة.
•	نوع العقار: يجب أن يتطابق نوع العقار.
•	حالة العقار: يجب أن تتطابق حالة العقار.
•	المساحة: يجب أن تتطابق المساحة.
•	الدور: يجب أن يتطابق الدور.
ملاحظات حول التصنيف:
•	هذا التصنيف ليس عيباً في العقار بحد ذاته.
•	تُعالج حالة التكرار بإحدى طريقتين يدويتين من قبل المستخدم:
o	إما حذف العقار إذا كان التكرار خطأ.
o	أو إلغاء خاصية التكرار إذا كان المالك يمتلك بالفعل عقارين بنفس المواصفات.
كيفية تعامل النظام بعد اكتشاف "عقار مكرر": بعد تسجيل ومعالجة العقار بنجاح، يتم إرسال إشعار إلى بوت التليجرام يوضح أن هذا العقار هو "عقار مكرر"، مع تضمين:
•	رابط الصفحة الشخصية للعقار المُعالج.
•	رابط الصفحة الخاصة بالعقار المتشابه معه.

-------------------------------------------
مفهوم "عقار متعدد": هو عقار تمت مقارنته مع عقارات أخرى، ووُجد أنه يتشابه معها فقط في "رقم المالك". هذا يعني أن المالك نفسه يمتلك أكثر من عقار.
كيفية تعامل النظام مع "عقار متعدد": عندما يتم معالجة هذا العقار بنجاح:
1.	يتم إنشاء صفحة عقار جديدة.
2.	يتم ربط صفحة العقار الجديدة هذه بالمالك الموجود مسبقاً (الذي يمتلك نفس رقم المالك).
3.	يتم إنشاء العلاقة الثنائية بين صفحة العقار الجديدة وصفحة المالك.
4.	النتيجة: يصبح المالك الواحد لديه أكثر من صفحة عقار مرتبطة به.

-------------------------------------------------
كيفية معالجة العقارات في القناة:
•	الشرط الأساسي للمعالجة: في كل مرة تبدأ فيها جلسة جديدة، أو طالما كانت الجلسة مستمرة، يتم معالجة جميع العقارات الموجودة في القناة.
•	استثناء من المعالجة: العقارات التي تحمل وسم "عقار ناجح" يتم استثناؤها من هذه المعالجة المتكررة.
•	فلتر "تاريخ آخر تحديث ناجح" (لتخفيف الضغط):
o	يتم تفعيل هذا الفلتر (أو أخذه في الاعتبار) فقط في حالة واحدة: عندما تكون جميع العقارات الموجودة في القناة، بلا استثناء، قد تمت معالجتها بنجاح وتحمل وسم "عقار ناجح".
o	(فهمي هنا أن هذا الفلتر سيسمح بتحديد نقطة زمنية معينة للبدء منها في المعالجة، بدلاً من البدء من البداية في كل مرة، ولكن فقط عندما تكون القناة "نظيفة" من العقارات غير المعالجة بنجاح.)

-----------------------------------------------------------
مفهوم "عقار ناجح": هو العقار الذي تتم معالجته بنجاح كامل، أي تتوافر وتكون صحيحة جميع الأجزاء/الحقول الخاصة به.
كيفية تعامل النظام مع "العقار الناجح": عندما يصبح العقار ناجحاً:
1.	يتم تصديره إلى Zoho.
2.	يتم تصديره إلى Notion، حيث يتم إنشاء صفحة خاصة به كعقار، وصفحة خاصة بالمالك (أو تحديث الموجودة)، ويتم ربطهما ببعض.
3.	يتم حذف الرسالة الأصلية التي وردت في القناة.
4.	يتم استبدال الرسالة الأصلية برسالة جديدة، بنفس التنسيق الذي تم الاتفاق عليه سابقاً لـ"عقار فاشل" (أي تتكون من حقل البيان الذي يضم: نوع العقار، حالة العقار، المنطقة، المساحة، الدور، السعر، كود الشقة، اسم الموظف، حالة الصور؛ بالإضافة إلى حقول اسم المالك، رقم المالك، اتاحة العقار، وتفاصيل كاملة).
5.	توسم هذه الرسالة الجديدة بـ"عقار ناجح".
---------------------------------------------
القاعدة: سلسلة معالجة الرسائل الخام بواسطة الذكاء الاصطناعي
بعد أن تصل الرسالة الخام إلى البوت، سيتم توجيهها إلى سلسلة من منصات الذكاء الاصطناعي لمعالجتها.
آلية التوجيه والمعالجة:
•	يتم توجيه الرسالة إلى هذه المنصات على التوالي (بالتسلسل).
•	يتوقف النظام عن الإرسال إلى المنصات التالية بمجرد نجاح إحداها في المعالجة. أي، إذا نجحت المنصة الأولى في السلسلة، فلن يتم إرسال الرسالة إلى المنصات المتبقية.
محاولات الإرسال لكل منصة:
•	يحاول النظام إرسال الطلب إلى كل منصة ذكاء اصطناعي حتى 3 مرات.
•	يتم الفصل بين كل محاولة والأخرى بفاصل زمني (مثلاً ثانية واحدة).
•	إذا تم الحصول على نتيجة ناجحة من أي من هذه المحاولات، يتوقف النظام فوراً ويستخدم هذه النتيجة.
في حالة فشل جميع المحاولات (لكل المنصات في السلسلة):
1.	يتم إرسال إشعار فوري إليك (المستخدم).
2.	يطلب منك الإشعار: "هل نكمل التحليل المنطقي؟"
3.	إذا كانت الإجابة "نعم": يتم تمرير "البيان" (المستخرج حتى تلك النقطة) إلى محلل بايثون الداخلي.
4.	إذا كانت الإجابة "لا": تتوقف العملية، وتكون مسؤوليتك (المستخدم) هي تحليل البيان يدوياً وإعادة إرساله.
المنصات التي سيتم محاولة استخدامها في السلسلة (إن أمكن):
•	Google Gemini
•	OpenAI
•	Microsoft Copilot
•	Mistral
•	Hugging Face
•	Cohere
•	Groq
------------------------------------------------------
لقاعدة 8: دليل تحليل بيانات العقارات وتنسيق البيان الكامل
•	الهدف: تحليل البيانات الخام وتنسيقها إلى "البيان العقاري الكامل".
•	تنسيق الناتج: حقل نصي واحد مع كل حقل وقيمته داخل [] وفي سطر جديد. ترتيب إلزامي للحقول.
•	قواعد تحليل الحقول وقيمها الافتراضية: (كما تم تفصيلها سابقاً، مع التحديثات التالية):
o	المناطق: z5 تشمل "حي اندلس" وz3 تشمل "اسكان شباب".
o	كود الوحدة: إذا تعذر استخراج مكونات الكود، يُعوض بـ"غير محدد" في الحقل و0 في الكود نفسه.
o	اسم المالك: القيمة الافتراضية "غير معروف".
o	عام: يجب ألا يحتوي الناتج الكامل على "ال" التعريف.
•	تصنيف "عقار تالف":
o	يُعتبر العقار تالفاً إذا لم تتوافر قيمة لأي من الحقول التالية: المنطقة، نوع الوحدة، حالة الوحدة، كود الوحدة، اسم المالك، رقم المالك.
o	عند معالجته بنجاح، يُرسل إشعار النجاح بأنه "عقار تالف" مع رابط لإصلاحه يدوياً.
•	التعويضات الافتراضية العامة: حقول نصية "غير محدد"، رقمية 00، رقم المالك 01000000000.
•	معالجة الإدخالات المتعددة: كل بيان يُعالج بشكل مستقل. الرقم التسلسلي لكود الوحدة يبدأ من 1 لكل مجموعة بيانات تحليل، ويتصاعد بمقدار 1 لكل بيان على حدة في نفس الطلب، وينتهي العد في اليوم ويبدأ من جديد كل يوم.
•	تنسيق الناتج الداخلي JSON.
________________________________________
القاعدة 9: آلية معالجة البيانات المتعددة (الدفعات)
•	تستمر معالجة البيانات المتعددة بالتوالي لتسهيل متابعة الإشعارات.
•	في حال فشل معالجة عقار واحد، تستكمل معالجة باقي العقارات في الدفعة.
•	بعد انتهاء جميع العقارات في الدفعة، يعود النظام لمعالجة العقارات التي فشلت مرة أخرى.
1. تحديثات على تعريفات المناطق (Zones):
•	z5: أصبحت تشمل: كمباوندات، احياء تجمع، بيت وطن، نرجس، لوتس، شويفات، زيزينيا، حي اندلس. (تم تحديد "حي اندلس" بشكل أكثر وضوح).
•	z3: أصبحت تشمل: اسكان شباب، سكن شباب، مستقبل، هناجر، نزهه ثالث. (تم إضافة "اسكان شباب" كقيمة مباشرة).
2. ملاحظة هامة حول حقل كود الوحدة [كود الوحدة: ...] وتصنيف "عقار تالف":
•	إذا تعذّر استخراج قيمة لأي من العناصر الإلزامية الثلاثة لكود الوحدة (نوع الحالة، رقم المنطقة، التاريخ):
o	داخل الحقل نفسه في البيان الناتج (مثل [كود الوحدة: غير محدد])، تُعوض القيمة بـ "غير محدد".
o	أما داخل سلسلة الكود الفعلية (c000-X-zY-DDMMYY-وحدة-رقم-تسلسلي)، تُعوض القيمة المفقودة بـ 0.
•	في هذه الحالة، يُعتبر العقار "عقار تالف". هذا التصنيف لا يعيق تحليله، وسيتم إرسال إشعار في نهاية العملية مع رابط العقارلإصلاحه.
3. قاعدة عامة لتنسيق الناتج ("ال" التعريف):
•	يجب ألا يحتوي الناتج الكامل (أي قيم الحقول في البيان النهائي) على "ال" التعريف. (هذا يطبق على جميع الحقول التي يمكن أن تحتويها، مثل "المميزات" و"الدور" وغيرها).
4. تحديث القيمة الافتراضية لحقل اسم المالك:
•	القيمة الافتراضية لحقل [اسم المالك: ...] إذا لم تُذكر هي الآن: "غير معروف" (بدلاً من "غير محدد").
5. تعريف وتصنيف "عقار تالف" الجديد:
•	يُعتبر العقار تالفاً إذا لم تتوافر قيمة لأي من الحقول التالية:
o	المنطقة
o	نوع الوحدة
o	حالة الوحدة
o	كود الوحدة
o	اسم المالك
o	رقم المالك
•	عندما يُعالج العقار بنجاح (رغم اعتباره تالفاً)، يتم إرسال إشعار بنجاح المعالجة، ويُضاف إليه أنه "عقار تالف" مع رابط للصفحة الخاصة به لتتمكن من إصلاحه يدوياً.
6. حذف قواعد سابقة:
•	تم حذف القاعدة التي تنص على "يجب أن تتوقف عملية التحليل ويُطلب إدخال يدوي" إذا غابت حقول المنطقة، نوع الوحدة، حالة الوحدة، أو كود الوحدة. (فهمي هو أن هذه الحالات ستُعامل الآن ضمن تصنيف "عقار تالف" بدلاً من إيقاف المعالجة).
•	القاعدة المتعلقة بالترقيم التلقائي للرقم التسلسلي في كود الوحدة الذي يبدأ من 1 لكل بيان فردي. (هذا يعني أن الجزء الذي ينص على "إذا تم تحليل عدة بيانات في نفس الطلب، يتصاعد هذا الرقم بمقدار 1 لكل بيان على حدة" قد تم إلغاؤه. ولكن فهمي أن "الرقم التسلسلي للوحدة يبدأ من 1 لكل مجموعة بيانات تحليل. وينتهي العد في يوم وييدا العد من جديد كل يوم
o	أرجو توضيح هذه النقطة: هل مازال يتم حذف الرسالة الأصلية واستبدالها بالبيان المنسق (كما اتفقنا للعقار الفاشل والناجح)، أم أن ما يُرسل للقناة هو دائماً النص الأصلي بغض النظر عن حالة المعالجة؟
8. آلية معالجة البيانات المتعددة:
•	تستمر عملية المعالجة على البيانات المتعددة بالتوالي لكي يسهل متابعة الإشعارات.
•	في حالة فشل أحدها (أحد العقارات في دفعة المعالجة): تستكمل عملية المعالجة حتى تنتهي جميع العقارات في الدفعة.
•	ثم يعود النظام إلى العمليات الفاشلة ليعيد معالجتها.
________________________________________
•	1. ما يُرسل إلى القناة (النص الأصلي مقابل البيان المنسق):
•	الفهم الجديد: "ولكن الذي يرسل إلى القناة النص الأصلي" يشير إلى عملية تحدث قبل المعالجة الأساسية التي تؤدي إلى تصنيف "عقار فاشل" أو "عقار ناجح".
•	هذا يعني أن:
•	في مرحلة ما قبل المعالجة، قد يتم إرسال النص الأصلي للرسالة إلى القناة.
•	ثم، بعد اكتمال المعالجة ووصول العقار لحالة "ناجح" أو "فاشل": يتم حذف الرسالة الأصلية ويُستبدل بها الرسالة الجديدة المنسقة (البيان) الموسومة بالحالة المناسبة (كما اتفقنا سابقاً).
•	بهذا، لا يوجد تعارض بين القاعدتين.
•	-------------------------------------------------------•  يتم تخزين البرومبت (الدليل) الذي يُرسل إلى منصات الذكاء الاصطناعي لتحليل البيان العقاري بناءً عليه، في ملف منفصل.
•	•  الهدف من هذا الملف المنفصل هو تسهيل تعديله وتطويره مستقبلاً.
•	---------------------------------
نعم، أتفهم تماماً التعديل والإضافة الهامة بخصوص التقارير اليومية.
•	________________________________________
•	القاعدة: ملف التقارير اليومية (محدثة)
•	يتم إنشاء ملف مخصص للتقارير.
•	يتم إرسال تقارير يومية توضح الإحصائيات التالية:
•	إجمالي عدد العقارات في القناة.
•	عدد العقارات الناجحة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات الفاشلة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات التالفة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات المكررة، مع الروابط الخاصة بهذه الصفحات.
•	عدد العقارات المتعددة، مع الروابط الخاصة بهذه الصفحات.
•	آخر تاريخ تحديث.
•	عدد العقارات التي تخص كل موظف (موزعة حسب اسم الموظف).
•	يتم تقديم هذه التقارير بشكل يومي.
•	
----------------------------------------------
لقاعدة: محتوى الإشعارات
•	كل إشعار يتم إرساله بخصوص عقار، يجب أن يوافقه (يتضمن):
•	كود العقار.
•	رابط الصفحة الخاصة به، وذلك إذا كان العقار يندرج تحت أحد التصنيفات التالية:
•	الفاشلة (عقار فاشل)
•	التالفة (عقار تالف)
•	المكررة (عقار مكرر)
•	المتعددة (عقار متعدد)
•	
-----------------------------
القاعدة: حقل "ستاتيوس" في Notion (محدثة)
•	يوجد حقل في Notion يُسمى "ستاتيوس" (Status).
•	نوع هذا الحقل هو "Multi-select" (اختيار متعدد).
•	يحتوي هذا الحقل على التصنيفات التالية:
•	عقار تالف
•	عقار فاشل
•	عقار متعدد
•	عقار مكرر
•	يتم تخصيص السمة (التصنيف) المقابلة لكل عقار في Notion بما يتناسب مع تفاصيله.
•	إضافة خاصة بتصنيف "عقار فاشل":
•	عندما يكون العقار "فاشلاً"، تُضاف إليه هذه السمة في حقل "ستاتيوس" في Notion.
•	وعندما تكتمل معالجة هذا العقار بنجاح مرة أخرى، تُحذف قيمة "عقار فاشل" من حقل "ستاتيوس" الخاص به.
•	
-----------------------------------
يتم إضافة أيقونة "صح" (✅) لكل عقار ناجح في صفحة العقار الخاصة به في Notion.
•	هذه الأيقونة تعمل كدليل بصري على أن العقار قد تمت معالجته بنجاح.
•	
--------------------------------


كل رسالة تعتبر بيان عقاري ما عدا اشعارات البوت نفسه والرد التلقائي من القناه  
----------------
نوع الرسائل المقبولة فقط هو النص ولكن لو ورد انواع اخري يتم تجاهلها
-----------------------
 ترتيب منصات الذكاء الاصطناعي المطلوب استخدامها
Google Gemini API
OpenAI API (ChatGPT):
Microsoft Copilot
Mistral AI
Hugging Face Inference API:
Cohere:
Groq:

 نعم نقف عند أول واحدة تنجح
---------------------
التنسيق المطلوب من الذكاء الاصطناعي  JSON 
دليل تحليل بيانات العقارات (تنسيق البيان الكامل 
يهدف هذا الدليل إلى توضيح كيفية تحليل بيانات العقارات وتنسيقها لتتوافق مع المعايير المطلوبة. يجب أن يكون الناتج في 
أي شخص يراسل البوت؟
-----------------
 لا اريد فلترة المصدر
----------------
كل رسالة تعتبر بيان عقاري ما عدا اشعارات البوت نفسه والرد التلقائي من القناه  
----------------
نوع الرسائل المقبولة فقط هو النص ولكن لو ورد انواع اخري يتم تجاهلها
-----------------------
 ترتيب منصات الذكاء الاصطناعي المطلوب استخدامها
Google Gemini API
OpenAI API (ChatGPT):
Microsoft Copilot
Mistral AI
Hugging Face Inference API:
Cohere:
Groq:

 نعم نقف عند أول واحدة تنجح
---------------------
التنسيق المطلوب من الذكاء الاصطناعي  JSON 
دليل تحليل بيانات العقارات (تنسيق البيان الكامل 
يهدف هذا الدليل إلى توضيح كيفية تحليل بيانات العقارات وتنسيقها لتتوافق مع المعايير المطلوبة. يجب أن يكون الناتج في 



العقاري الكامل، مع كل حقل وقيمته داخل قوسين مربعين []، وكل حقل وقيمته في سطر جديد داخل نفس الحقل الكبير. 

مثال للناتج المطلوب (بيان كامل كحقل واحد):

1 | [المنطقة: احياء تجمع]
  | [كود الوحدة: c000-3-z5-220725-وحدة-1]
  | [نوع الوحدة: شقة]
  | [حالة الوحدة: تمليك]
  | [المساحة: 150]
  | [الدور: دور اول]
  | [السعر: 1500000]
  | [المميزات: تشطيب سوبر لوكس, حديقه]
  | [العنوان: التجمع الخامس]
  | [اسم الموظف: بلبل]
  | [اسم المالك: احمد محمود]
  | [رقم المالك: 01012345678]
  | [اتاحة العقار: متاح]
  | [حالة الصور: صور متاحة]
  | [تفاصيل كاملة: شقة 150 متر بالتجمع الخامس تشطيب سوبر لوكس بحديقه تبع بلبل]
-------------------------------------------------
2 | [المنطقة: اندلس]
  | [كود الوحدة: c000-2-z5-220725-وحدة-2]
  | [نوع الوحدة: شقة]
  | [حالة الوحدة: مفروش]
  | [المساحة: 130]
  | [الدور: دور تالت]
  | [السعر: 20000]
  | [المميزات: مكيفه, فيو مفتوح, اسانسير, انترنت, اجهزه كهربائيه]
  | [العنوان: اندلس]
  | [اسم الموظف: يوسف عماد]
  | [اسم المالك: هدي المفتي]
  | [رقم المالك: 01000011109]
  | [اتاحة العقار: غير متاحه]
  | [حالة الصور: صور غير متاحة]
  | [تفاصيل كاملة: الشقه المفروشه اندلس ١٣٠ م مميزات الشقه الشقه كلها مكيفه تكييفات جديده كلها بحري صريح و ناصيه شرقي بحري اكبر وايد فيو في الاندلس كلها تتطل مباشره علي منطقه خدمات ٥ اقرب جار في الوجهه علي بعد ١٥٠٠ متر الشقه علي ناصيه دور متكرر الدور التالت كل الاجهزه الكهربائيه متاحه وشغاله بكفائه عاليه شامله كمان توستر ميكرو ويف هاند بلندر سخان غاز غساله فول اتوماتيك انترنت فائق السرعه فيبر اوبتك واي فاي و تليفون ارضي كل العدادات متاحه الايجار حسب مده العقد بس في حدود ٢٠ الف شهري الفرش كله جديد و فخم اخشاب طبيعيه مش مصنعه غرفه سريرين ١٢٠ و غرفه سرير كبير ١٨٠ و غرفه ليفينج كنب بيقلب سريرين ١٢٠ و تحتهم سحاره للتخزين١ المصعد موجود و شغال تبع يوسف عماد هدي المفتي 01000011109 بدون صور غير متاحه]
قواعد تحليل الحقول
المنطقة [المنطقة: ...]
تُحدد المنطقة بناءً على "الزونات" المحددة:

z1: دار قرنفل، قرنفل فيلات، بنفسج، ياسمين، ج ش اكاديميه

z3: سكن شباب، مستقبل، هناجر، نزهه ثالث

z4: رحاب، جاردينيا سيتي

z5: كمباوندات، احياء تجمع، بيت وطن، نرجس، لوتس، شويفات، زيزينيا، اندلس، دار اندلس، سكن اندلس، سكن معارض، جنه، جاردينيا هايتس

قواعد إضافية للمنطقة:

إذا ذُكر "الحي الخامس" أو "الحي الرابع"، تُعتبر "احياء تجمع".

إذا ذُكر "الشباب" أو "التجمع الثالث" أو "اسكان الثالث"، تُعتبر "اسكان شباب". 



كود الوحدة [كود الوحدة: c000 + {1-3} + -z{1-5} + -DDMMYY + -وحدة-رقم-تسلسلي]
يتكون كود الوحدة من الأجزاء التالية:

نوع الحالة:

t1 (فاضي) يُستبدل بـ -1.

t2 (مفروش) يُستبدل بـ -2.

t3 (تمليك) يُستبدل بـ -3.

رقم المنطقة: z يُحدد حسب المنطقة أعلاه (z1, z3, z4, z5) ويُستبدل برقم المنطقة مباشرة (مثال: -5 للمنطقة z5).

التاريخ: nDDMMYY يُستبدل n بـ - والتاريخ بصيغة DDMMYY. يجب استخدام تاريخ اليوم الحالي تلقائيًا (مثال: -220725 لتاريخ 22 يوليو 2025).

الرقم التسلسلي للوحدة: -وحدة-رقم-تسلسلي: رقم تسلسلي للوحدة يبدأ من 1 لكل مجموعة بيانات تحليل. إذا تم تحليل عدة بيانات في نفس الطلب، يتصاعد هذا الرقم بمقدار 1 لكل بيان على حدة (مثال: -1, -2, -3). وينتهي العد في يوم 
ويبدا العد من جديد كل يوم
 

⚠ ملاحظة: الكود مكوّن من 3 عناصر إلزامية،  يجوز تعويضه بقيمه غير محدد ولكن يعتبر العقار غير مكتملا وهذا لا يعيق تحليله ولكن يرسل ف نهايه العمليه اشعار لاصلاحه

نوع الوحدة [نوع الوحدة: شقة، فيلا، دوبلكس، بنتهاوس

]عماره - محل  - عياده -  روف - بيزمنت 

حالة الوحدة [حالة الوحدة: فاضي، مفروش، تمليك - اداري - نصف مفروش] 



المساحة [المساحة: أرقام فقط]
يجب أن تكون أرقام فقط.
إذا لم تُذكر، القيمة الافتراضية هي 00.

الدور [الدور: بصيغة مثل "دور تاني" بدون "ال"]
يجب أن يكون بصيغة مثل "دور تاني" بدون "ال" التعريف.
إذا لم يُذكر، القيمة الافتراضية هي "غير محدد".

السعر [السعر: أرقام فقط]
يجب أن يكون أرقام فقط.
إذا لم تُذكر، القيمة الافتراضية هي 00.

المميزات [المميزات: فقط من القائمة التالية، بدون "ال"]
القيم المسموح بها: تشطيب سوبر لوكس، مدخل خاص، دبل فيس، اسانسير، حصه في ارض، حديقه، فيو مفتوح، فيو جاردن، مسجله شهر عقاري، تقسيط، مكيفه، باقي اقساط.
إذا لم تُذكر أي ميزة، القيمة الافتراضية هي "غير محدد".

العنوان [العنوان: نص قصير من البيان]
نص قصير من البيان.
إذا لم يُذكر، القيمة الافتراضية هي "غير محدد".

اسم الموظف [اسم الموظف: يُستخرج من كلمة "تبع"]
قائمة الأسماء المعتمدة: بلبل، اسلام، ايمن، تاحه، علياء، محمود سامي، يوسف، عماد، يوسف الجوهري.
إذا لم تُذكر، القيمة الافتراضية هي "غير محدد".

اسم المالك [اسم المالك: اسم شخص كامل]
اسم شخص كامل.
إذا لم تُذكر، القيمة الافتراضية هي "غير محدد".

رقم المالك [رقم المالك: رقم مكون من 11 رقمًا]
رقم مكون من 11 رقمًا.
إذا لم تُذكر، القيمة الافتراضية هي 01000000000.

اتاحة العقار [اتاحة العقار: متاح، غير متاح، مؤجر]
القيم المسموح بها: متاح، غير متاح، مؤجر.
إذا لم تُذكر، القيمة الافتراضية هي "غير محدد".

حالة الصور [حالة الصور: صور متاحة، صور غير متاحة، صور غير محددة]
القيم المسموح بها: صور متاحة، صور غير متاحة، صور غير محددة.
إذا لم يُذكر شيء بخصوص الصور، القيمة الافتراضية هي "صور غير محددة".

تفاصيل كاملة [تفاصيل كاملة: النص الأصلي الكامل بعد حذف حقل "اسم المالك" و"رقم المالك" و "اتاحة العقار" و "حالة الصور"]
النص الأصلي الكامل بعد حذف حقول "اسم المالك" و"رقم المالك" و "اتاحة العقار" و "حالة الصور".
يجب أن يُكتب في سطر واحد فقط بدون أسطر جديدة أو فواصل.

التعويضات الافتراضية للحقول الغائبة
الحقول النصية: "غير محدد"

الحقول الرقمية (مثل المساحة، السعر): 00

حقل رقم المالك: 01000000000

استثناء هام: إذا غابت "المنطقة" أو "نوع الوحدة" أو "حالة الوحدة" أو "كود الوحدة"، يجب التوقف وطلب إدخالهم يدويًا.

ترتيب الناتج
يجب أن يظهر الناتج دائمًا بالترتيب التالي داخل الحقل الواحد للبيان، مع كل حقل وقيمته داخل قوسين مربعين وفي سطر منفصل.  | [المنطقة: ...]
                          [كود الوحدة: ...]
                            [نوع الوحدة: ...]
                           [حالة الوحدة: ...]
                            [المساحة: ...]
                            [الدور: ...]
                            [السعر: ...]
                            [المميزات: ...]
                            [العنوان: ...]
                            [اسم الموظف: ...]
                            [اسم المالك: ...]
                            [رقم المالك: ...]
                            [اتاحة العقار: ...]
                            [حالة الصور: ...]
                            [تفاصيل كاملة: ...]
معالجة الإدخالات المتعددة
إذا تم إدخال أكثر من بيان عقاري (سواء في رسائل منفصلة أو في نص واحد متتالي مغلق كنسخة من محادثات)، يجب فصل وتحليل كل بيان على حدة. يُعامل كل بيان ككيان مستقل بنفس القواعد المذكورة أعلاه، مع ترقيم تلقائي للرقم التسلسلي في كود الوحدة (الذي يكون جزءًا من كل بيان فردي) 1. 
هذا البروميت سنقوم بتطويره خطوه بخطوه ليكون شاملا
-------------------------------------
regex خاص بالمشروع إذا فشلت المنصات الثلاثة؟
نعم اكيد 
افضل وجود محلل داخلي احتياطي (نظام regex خاص)، تريده ذكي بشكل تدريجي (يعني يحلل أي جزء يستطيع فهمه)؟
--------------------------------
قناه واحده خاصه بي
سيتم أرسال الرساله الخام مؤقتا إلى أن يتم تخزينها في نوشن وزوهو وتتم العملية بنجاح وقتها يتم تعديل النص وإضافة وسم معالجة ناجحة وإن لم ينفع التعديل يتم حذفها وأرسال نسخة منسقة وسنتفق عليها بنفس الوسم وكذلك إذا فشلت، إما أن تعدل ويضاف وسم معالجة فاشلة، وإن لم ينفع التعديل تحذف ويرسل نسخة سنتفق عليها بنفس الوسم
--------------------------------------------
البيان سيقسم إلى قسمين كامل البيان باستثناء  حقلي اسم المالك وحقل رقم المالك سيتم تغزين هذا البيان بالكامل في صفحة تسمى عقار أما اسم المالك ورقم المالك سيتم تغزينهم في صفحة أخرى باسم مالك عقار وسوف يتم إنشاء علاقة ثنائيه 
الاثنين يربط الصفحتين ببعض
--------------------------------------------
سيتم تخزين كامل البيان في زهو في موديول باسم عقار.
على العلم أن جميع الحقول التي ذكرتها في الردود ليست مكتوبة بشكل صحيح تماما
---------------------------------------------
أنا صنعت تليجرام بوت مخصص لاستقبال الإشعارات في الحال وقت تنفيذ العملية وأفضل تقارير في نهاية اليوم عن عدد العمليات الناجحة وعدد العمليات الفاشلة وكذلك التصنيفات الأخرى التي سنضيفها
---------------------------------------------
نعم  افضل أرشفة كل بيان داخل قناة بشكل بصري أنيق (رموز + 
تنسيق)؟ نعم اريد إرفاق رابط صفحة Notion أو Zoho معه؟
---------------------------------------------------
 نعم اريد أن نعطي كل وحدة كود فريد وتم شرح ذالك في الروميت العقاري الذى ارفقته فوق
--------------------------------------------------
لا افكر في إضافة إمكانية تعديل بيانات عقار سابق أو حذفها لاحقًا
-----------------------------------
ارجو ان يتم استخدام الحقول التي ذكرتها في البروميت والاستعانه به في التحليل
يحتوي على الحقول الأساسية:

                          [كود الوحدة: ...]
                            [نوع الوحدة: ...]
                           [حالة الوحدة: ...]
                            [المساحة: ...]
                            [الدور: ...]
                            [السعر: ...]
                            [المميزات: ...]
                            [العنوان: ...]
                            [اسم الموظف: ...]
                            [اسم المالك: ...]
                            [رقم المالك: ...]
                            [اتاحة العقار: ...]
                            [حالة الصور: ...]
                            [تفاصيل كاملة: ...]

======================================
القاعدة الأولى نبدأ بعمليات الأرسال إذا تم استقبال أرسالة سيتم توجيهها إلى منصات الذكاء الاصطناعي إما بالتوازي أو على التوالي لا فرق عندي ولكن مع أول غد تتوقف عملية الطلب ونأخذ التحليل أو النتيج ونذهب به إلى البوت ترجام ليوجهه إلى القناة إذا فشلت جميع عمليات التوجيه لمنصات الذكاء الاصطناعي يتم إرسال إشعار لي بطلب تأكيد نعم أو لا نعم أي أن العملية يتم استكمالها عن طريق النظام بإدخال البيان على لغة بايثون ليقوم هو بتحليلها عن طريق التعديل المنطقي لا أي سأقوم أنا بأخذ البيان وتحليله يدويا وإعادته إلى البوت
نعم افضل مهله زمنيه 15 ثانيه
الإشعار يأتي فورًا بعد فشل الذكاء الاصطناعي 

سأطلب الإشعار بعد فشل الذكاء الاصطناعي لأنني سأحدد إن كان البيان بصيغة يستطيع التعبير المنطقي تحليلها فسأضغط نعم وإن كان بصيغة عشوائية سأحلله أنا يدويا
============================================
د أن تُرسل الرسالة إلى القناة الخاصة، يبدأ النظام في تنفيذ خطوات التخزين:

تُستخرج البيانات من code.json — التي جاءت من الذكاء الاصطناعي أو من التحليل اليدوي أو المنطقي.

يتم إرسال هذه البيانات إلى:

✅ صفحة "عقار" في Notion.

✅ موديول واحد فقط في Zoho (وحدة "Aqar").

في Notion:

تُخزن الحقول الكاملة (مثل النوع، الحالة، السعر...).

حقل "اسم المالك" و"رقم المالك" يُخزنان في صفحة مستقلة باسم "مالك عقار".

هناك علاقة ثنائية بين صفحة "عقار" وصفحة "مالك عقار".

في Zoho:

يُخزن كل شيء داخل موديول واحد فقط (وحدة "عقار")، ولا يتم إنشاء وحدة مالك منفصلة.

قد يتم تنقيح الحقول لاحقًا.

بعد نجاح التخزين:

يتم تعديل الرسالة داخل القناة الخاصة وإضافة وسم: ✅ عقار ناجح
في حالة الفشل:

حذفها وإعادة إرسال نسخة جديدة منها مع الوسم.

عند تشغيل التطبيق، يقوم بفحص الرسائل داخل القناة.

يتم تجاهل أي رسالة تحتوي على الوسم [تمت المعالجة بنجاح] (أو ما سيتم الاتفاق عليه لاحقًا).

لتجنّب فحص جميع الرسائل القديمة في كل مرة، نقوم بإضافة شرط إضافي:

🔸 يتم تحديد "تاريخ آخر تحديث ناجح" كمرجع زمني.

كيف نحصل على هذا التاريخ؟

عندما يتم التأكد أن جميع الرسائل داخل القناة تم معالجتها (أي لا توجد رسالة بدون وسم المعالجة)، عندها:

يتم تسجيل التاريخ والوقت الحالي باعتباره "آخر تحديث ناجح".

في الجلسات القادمة، سيتم تجاهل أي رسالة أقدم من هذا التاريخ وتوفير الوقت والموارد.



نعم، Railway هو الخيار الأنسب حاليًا لخطتك، وسيسمح لنا بتشغيل main.py طوال الوقت بشكل تلقائي، مع إمكانيات نشر سهلة.
تحليل بيان عقاري، 
الناتج: يجب أن يكون الناتج عبارة عن الكلمة الدلالية مفصولة عن القيمة بعلامة : وموضوعة داخل أقواس مربعة []. 
مثال: [الكلمة الدلالية: القيمة] 

القواعد: 
[المنطقة: ...] 

الزونات: 
z1: دار قرنفل، قرنفل فيلات، بنفسج، ياسمين، ج ش اكاديميه 
z3: سكن شباب، مستقبل، هناجر، نزهه ثالث 
z4: رحاب، جاردينيا سيتي 
z5: كمباوندات، احياء تجمع، بيت وطن، نرجس، لوتس، شويفات، زيزينيا، اندلس، دار اندلس، سكن اندلس، سكن معارض، جنه، جاردينيا هايتس 

قواعد إضافية للمنطقة: 
إذا ذُكر "الحي الخامس" أو "الحي الرابع" ← اعتبرها "احياء تجمع" 
إذا ذُكر "الشباب" أو "التجمع الثالث" أو "اسكان الثالث" ← اعتبرها "سكن شباب" 
إذا لم تُذكر المنطقة أو لم تُستنتج ← يجب إيقاف التحليل وطلب إدخالها يدويًا. 

[كود الوحدة: c000 + {1-3} + -z{1-5} + -DDMMYY + -وحدة-رقم-تسلسلي]  
t1 = فاضي (سيتم استبدال t1 بـ -1)  
t2 = مفروش (سيتم استبدال t2 بـ -2)  
t3 = تمليك (سيتم استبدال t3 بـ -3)  
z يُحدد حسب المنطقة أعلاه (z1, z3, z4, z5) (سيتم استبدال z برقم المنطقة مباشرة، مثال: -5 للمنطقة z5)  
nDDMMYY سيتم استبدال n بـ - والتاريخ بصيغة DDMMYY (مثال: -200725 لتاريخ 20 يوليو 2025).  
جديد: -وحدة-رقم-تسلسلي: رقم تسلسلي للوحدة يبدأ من 1 لكل مجموعة بيانات تحليل. إذا تم تحليل عدة بيانات في نفس الطلب، يتصاعد هذا الرقم بمقدار 1 لكل بيان على حدة (مثال: -1, -2, -3).  
⚠ الكود مكوّن من 3 عناصر إلزامية، ولا يجوز تعويضه بأي شكل، ويجب استخدام تاريخ اليوم الحالي تلقائيًا بصيغة DDMMYY (مثال: 200725). 

[نوع الوحدة: شقة، فيلا، دوبلكس، بنتهاوس]  
إذا لم تُذكر ← يجب إيقاف التحليل وطلب إدخالها يدويًا.  

[حالة الوحدة: فاضي، مفروش، تمليك]  
إذا لم تُذكر ← يجب إيقاف التحليل وطلب إدخالها يدويًا.  

[المساحة: أرقام فقط]  
إذا لم تُذكر ← 00  

[الدور: بصيغة مثل "دور تاني" بدون "ال"]  
إذا لم يُذكر ← "غير محدد"  

[السعر: أرقام فقط]  
إذا لم تُذكر ← 00  

[المميزات: فقط من القائمة التالية، بدون "ال"]  
تشطيب سوبر لوكس، مدخل خاص، دبل فيس، اسانسير، حصه في ارض، حديقه، فيو مفتوح، فيو جاردن، مسجله شهر عقاري، تقسيط، مكيفه، باقي اقساط  
إذا لم تُذكر أي ميزة ← "غير محدد"  

[العنوان: نص قصير من البيان]  
إذا لم يُذكر ← "غير محدد"  

[اسم الموظف: يُستخرج من كلمة "تبع"]  
قائمة الأسماء: بلبل، اسلام، ايمن، تاحه، علياء، محمود سامي، يوسف، عماد، يوسف الجوهري  
إذا لم يُذكر ← "غير محدد"  

[اسم المالك: اسم شخص كامل]  
إذا لم تُذكر ← "غير محدد"  

[رقم المالك: رقم مكون من 11 رقمًا]  
إذا لم يُذكر ← 01000000000  

[اتاحة العقار: متاح، غير متاح، مؤجر]  
إذا لم تُذكر ← "غير محدد"  

[حالة الصور: صور متاحة، صور غير متاحة، صور غير محددة]  
إذا لم يُذكر شيء بخصوص الصور ← "صور غير محددة"  

[تفاصيل كاملة: النص الأصلي الكامل بعد حذف حقل "اسم المالك" و"رقم المالك" و "اتاحة العقار" و "حالة الصور"]  
يجب أن يُكتب في سطر واحد فقط بدون أسطر جديدة أو فواصل.  

التعويضات الافتراضية للحقول الغائبة:  
الحقول النصية: "غير محدد"  
الحقول الرقمية (مثل المساحة، السعر): 00  
حقل (رقم المالك): 01000000000  

استثناء: إذا غابت "المنطقة" أو "نوع الوحدة" أو "حالة الوحدة" أو "كود الوحدة" ← يجب التوقف وطلب إدخالهم يدويًا.  

الناتج دائمًا بهذا الترتيب:  
[المنطقة: ...]  
[كود الوحدة: ...]  
[نوع الوحدة: ...]  
[حالة الوحدة: ...]  
[المساحة: ...]  
[الدور: ...]  
[السعر: ...]  
[المميزات: ...]  
[العنوان: ...]  
[اسم الموظف: ...]  
[اسم المالك: ...]  
[رقم المالك: ...]  
[اتاحة العقار: ...]  
[حالة الصور: ...]  
[تفاصيل كاملة: ...]

معالجة إدخالات متعددة:  
إذا تم إدخال أكثر من رسالة (بيان عقاري) ليتم تحليلهم، يجب الفصل بين الناتج لكل بيان بسطر من الشرطات العريضة:  
-------------------------------------------------

🆕 قاعدة إضافية:  
إذا تم إدخال أكثر من بيان عقاري في **نص واحد متتالي مغلق** (مثل نسخ من محادثات واتساب أو فيسبوك أو أي فقرة تحتوي على بيانات متعددة دون فواصل واضحة)، فيجب فصل وتحليل كل بيان على حدة، ويُعامل على أنه بيان مستقل بنفس القواعد، مع ترقيم تلقائي للرقم التسلسلي في كود الوحدة، والفصل بين النتائج بسطر شرطات:
-------------------------------------------------
[7/19/2025 12:12 PM] علياء السويدي مكتب ؟: شقة مفروشة للايجار 
بالتجمع الخامس النرجس 
200 متر 
دور تاني
تشطيب الترا سوبر لوكس 
2 نوم ب تكييف - 2 حمام - مطبخ بثلاجة وفرن وميكروييف وغسالة اطباق وأدوات مطبخ - رسيبشن 
عداد كهربا وعداد مياه وغاز طبيعي 
مطلوب 60.000
[7/19/2025 12:43 PM] محمد نبيل ؟: شقه للايجار 100 م 
غاز كهربائي مياه وخط ارضي موقع مميز بجوار فيوتشر مول وكافه الخدمات والمرافق
محليه 7
 قبل الاخير
 تشطيب سوبر لوكس 
السعر 8000 نهائي
[7/19/2025 12:48 PM] Mo nabil Office ؟: شقة للايجار بالتجمع الثالث
محلية ٤ 
دور اول بلكونه فوق الارضي 
100م 
هتفضي بعد شهر 
تشطيب شركة 
السعر 7000 
غاز كهرباء مياه
[7/19/2025 1:44 PM] علياء السويدي مكتب ؟: شقة للايجار مفروشة في التجمع الخامس بحي إسكان الجامعة الامريكية
 قريبه جدا من point 90 
154متر
دور تاني خلفي ويوجد اسانسير
تشطيب سوبر لوكس 
( 3 غرف نوم 3حمام - ريسبشن قطعتين - مطبخ )
كامله الأجهزة الكهربائية
يوجد 2 تكييف وشاشتين سمارت وواي فاي   
المعاينة بنحدد معاد قبلها لعدم التواجد المستمر بالشقة 
مطلوب 25 الف 
اقل مده 6 شهور
[7/19/2025 3:24 PM] علياء السويدي مكتب ؟: شقة فاضية للايجار في الاندلس 1
185 متر
دور تاني 
3 نوم منهم ماستر / 3 حمام / مطبخ / رسيبشن 3 قطع
عمارة ناصية بجوار قطاميه ديوز 
مطلوب 15.000
[7/19/2025 4:21 PM] علياء السويدي مكتب ؟: شقة فاضية للايجار في التجمع الخامس - اللوتس الجديدة
200 متر 
3 نوم منهم ماستر - 3 حمامات - رسيبشن كبير 3 قطع 
دور اول علوي وفي اسانسير 
واجهة بانوراما بالكامل - تشطيب سوبر لوكس 
" اول سكن "
مطلوب 18 الف ويوجد تفاوض 


# =========================
GEMINI_API_KEY = os.environ.get("GEMINI_API_KEY", "AIzaSyBSqPgo0TM3JMHLP6LAb2tSVfagcYKHkAc")
NOTION_API_KEY = os.environ.get("NOTION_API_KEY", "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")
PROPERTIES_DATABASE_ID = os.environ.get("PROPERTIES_DATABASE_ID", "4f4af5e86fd94104bb8f6a931a187936")
OWNERS_DATABASE_ID = os.environ.get("OWNERS_DATABASE_ID", "224ecf34ff0080009116ee1fae53330e")
NOTION_API_DELAY = float(os.environ.get("NOTION_API_DELAY", "0.3"))
ZOHO_CLIENT_ID = os.environ.get("ZOHO_CLIENT_ID", "1000.OBIGSUQKCC2THQM9VY3TXW6NXV9WHV")
ZOHO_CLIENT_SECRET = os.environ.get("ZOHO_CLIENT_SECRET", "58db3c4cfd6522f8cca0282747ef300514f55c1ad8")
ZOHO_REFRESH_TOKEN = os.environ.get("ZOHO_REFRESH_TOKEN", "1000.a7e96420b2fd242b26732fa7f5a4c2f6.8269f1c317bdbbac53666a61d9fbe454")
ZOHO_REDIRECT_URI = os.environ.get("ZOHO_REDIRECT_URI", "https://www.zoho.com")
ZOHO_MODULE_NAME = os.environ.get("ZOHO_MODULE_NAME", "Aqar")
TELEGRAM_API_ID = int(os.environ.get("TELEGRAM_API_ID", "23358202"))
TELEGRAM_API_HASH = os.environ.get("TELEGRAM_API_HASH", "d66eecdb7446f53d7d591d579de535ca")
TELEGRAM_BOT_INPUT_TOKEN = os.environ.get("TELEGRAM_BOT_INPUT_TOKEN", "8135541726:AAHxZAfaYIksBD1Lma12x5GbVzbpxsKhVmk")
TELEGRAM_BOT_OUTPUT_TOKEN = os.environ.get("TELEGRAM_BOT_OUTPUT_TOKEN", "7238037158:AAEIEkWPUaR76ndCbwm9r7b8cyKrEac6sOM")
TELEGRAM_NOTIFICATION_CHAT_ID = os.environ.get("TELEGRAM_NOTIFICATION_CHAT_ID", "5584501657")
TELEGRAM_PRIVATE_CHANNEL_ID = int(os.environ.get("TELEGRAM_PRIVATE_CHANNEL_ID", "-1002874153693"))
# Google Gemini API
GEMINI_API_KEY = "AIzaSyBSqPgo0TM3JMHLP6LAb2tSVfagcYKHkAc"

# OpenAI API
OPENAI_API_KEY="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"

# Telegram Configuration
TELEGRAM_API_ID=23358202
TELEGRAM_API_HASH="d66eecdb7446f53d7d591d579de535ca"
TELEGRAM_BOT_OUTPUT_TOKEN="7238037158:AAEIEkWPUaR76ndCbwm9r7b8cyKrEac6sOM"
TELEGRAM_PRIVATE_CHANNEL_ID="8135541726:AAHxZAfaYIksBD1Lma12x5GbVzbpxsKhVmk"
TELEGRAM_NOTIFICATION_CHAT_ID="5584501657"

TELEGRAM_PRIVATE_CHANNEL_ID = -1002874153693
# Zoho CRM Configuration
ZOHO_CLIENT_ID = "1000.OBIGSUQKCC2THQM9VY3TXW6NXV9WHV"
ZOHO_CLIENT_SECRET = "58db3c4cfd6522f8cca0282747ef300514f55c1ad8"
ZOHO_REFRESH_TOKEN = "1000.a7e96420b2fd242b26732fa7f5a4c2f6.8269f1c317bdbbac53666a61d9fbe454"
ZOHO_REDIRECT_URI = "https://www.zoho.com"
ZOHO_MODULE_NAME = "Aqar"


# Notion Configuration
NOTION_API_KEY = "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"
PROPERTIES_DATABASE_ID = "4f4af5e86fd94104bb8f6a931a187936"
OWNERS_DATABASE_ID = "224ecf34ff0080009116ee1fae53330e"
NOTION_API_DELAY = 0.3  # Delay between API calls (seconds)
mistral_API_KEY = "soMr4s2jGPzGrKO00BOjOh7Vrhb5IxMP"
huggingface_API_KEY = "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"
groq_API_KEY = "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"

GEMINI_API_KEY = "AIzaSyBaioOh7ELXG2Xb1QjA3YE6wdWCDLdKsvY"
GEMINI_API_KEY = "AIzaSyBXGqbXJk0VyivjSwLPidU9HYPqmTfqLCk"

==============================================
خصائص حقول نوشن وزوهو
 properties = {
            "البيان": {"title": [{"text": {"content": prop.get("البيان", "")}}]},
            "المنطقة": {"select": {"name": prop.get("المنطقة", "غير محدد")}},
            "كود الوحدة": {"rich_text": [{"text": {"content": prop.get("كود الوحدة", "")}}]},
            "نوع الوحدة": {"select": {"name": prop.get("نوع الوحدة", "غير محدد")}},
            # Multi-select requires list of dicts for each option
            "حالة الوحدة": {"multi_select": [{"name": val.strip()} for val in prop.get("حالة الوحدة", "").split(",") if val.strip()]},
            "المساحة": {"number": int(re.sub(r"[^\d]", "", prop.get("المساحة", "0")))}, # استخراج الأرقام فقط
            "الدور": {"multi_select": [{"name": val.strip()} for val in prop.get("الدور", "").split(",") if val.strip()]},
            "السعر": {"number": int(re.sub(r"[^\d]", "", prop.get("السعر", "0")))}, # استخراج الأرقام فقط
            "المميزات": {"rich_text": [{"text": {"content": prop.get("المميزات", "")}}]},
            "العنوان": {"rich_text": [{"text": {"content": prop.get("العنوان", "")}}]},
            "اسم الموظف": {"select": {"name": prop.get("اسم الموظف", "غير محدد")}},
            "اسم المالك": {"rich_text": [{"text": {"content": prop.get("اسم المالك", "")}}]},
            "رقم المالك": {"phone_number": prop.get("رقم المالك", "")},
            "اتاحة العقار": {"select": {"name": prop.get("اتاحة العقار", "غير محدد")}},
            "حالة الصور": {"select": {"name": prop.get("حالة الصور", "غير محدد")}},
            "تفاصيل كاملة": {"rich_text": [{"text": {"content": prop.get("تفاصيل كاملة", "")}}]},
        }
       ===================================================


